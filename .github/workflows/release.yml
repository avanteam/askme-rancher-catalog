name: AskMe Rancher Catalog - Manual Release

# Workflow simple pour tests manuels ou releases ponctuelles
# Le workflow principal est dans askme-app-aoai/deploy.yml

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version Ã  packager (ex: 1.0.3)'
        required: true
        type: string

jobs:
  manual-release:
    name: ðŸ“¦ Manual Chart Release
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Helm
        uses: azure/setup-helm@v3
        with:
          version: '3.12.0'

      - name: Manual Package and Index
        run: |
          echo "ðŸ“¦ Manual packaging for version ${{ github.event.inputs.version }}"
          
          # Update Chart.yaml manually
          sed -i "s/^version:.*/version: ${{ github.event.inputs.version }}/" charts/askme/Chart.yaml
          sed -i "s/^appVersion:.*/appVersion: \"${{ github.event.inputs.version }}\"/" charts/askme/Chart.yaml
          
          # Package chart vers releases/
          helm package charts/askme --destination ./releases

          # Create index depuis releases/
          helm repo index releases --url https://raw.githubusercontent.com/avanteam/askme-rancher-catalog/prod/releases
          mv releases/index.yaml ./
          
          echo "âœ… Manual package created:"
          ls -la releases/*.tgz

      - name: Commit Changes
        run: |
          git config user.name "Manual Release"
          git config user.email "noreply@avanteam.com"
          
          git add .
          git commit -m "ðŸ“¦ Manual release v${{ github.event.inputs.version }}"
          
          echo "âœ… Ready to push manually"
          echo "ðŸ’¡ Use: git push to apply changes"