apiVersion: v1
kind: Secret
metadata:
  name: {{ include "askme.fullname" . }}-secrets
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "askme.labels" . | nindent 4 }}
    askme.avanteam.com/client-id: {{ .Release.Name }}
  annotations:
    askme.avanteam.com/client: {{ .Release.Name }}
    askme.avanteam.com/domain: {{ .Values.client.domain }}
    askme.avanteam.com/deployed-at: {{ now | date "2006-01-02T15:04:05Z07:00" }}
type: Opaque
stringData:
  # === PLACEHOLDER POUR SECRET INITIAL ===
  # Ce secret sera fusionné avec askme-tokens par le job de sync
  # Seules les clés NON-par-défaut seront gardées (overrides client)
  
  {{- if and .Values.azure.openai.key (ne .Values.azure.openai.key "your-azure-openai-key-here") }}
  AZURE_OPENAI_KEY: {{ .Values.azure.openai.key | quote }}
  {{- end }}
  {{- if and .Values.claude.apiKey (ne .Values.claude.apiKey "your-claude-api-key-here") }}
  CLAUDE_API_KEY: {{ .Values.claude.apiKey | quote }}
  {{- end }}
  {{- if and .Values.azure.search.key (ne .Values.azure.search.key "your-azure-search-key-here") }}
  AZURE_SEARCH_KEY: {{ .Values.azure.search.key | quote }}
  {{- end }}
  {{- if and .Values.avanteam.authToken (ne .Values.avanteam.authToken "@v@nt€m-Q@litYs@AS-d€v31") }}
  AVANTEAM_AUTH_TOKEN: {{ .Values.avanteam.authToken | quote }}
  {{- end }}
  
  # Placeholder pour éviter secret vide
  PLACEHOLDER: "will-be-replaced-by-global-tokens"